
var dataset = [
	{
		"created_time":"2015-01-01T12:30",
		"actual": 337.7,
		"predicted": 506.8629090622853
	},
	{
		"created_time":"2015-01-02T12:30",
		"actual": 544.13,
		"predicted": 513.7654045324598,
	},
	{
		"created_time":"2015-01-03T12:30",
		"actual": 612.94,
		"predicted": 534.4728909430123
	},{
		"created_time":"2015-01-04T12:30",
		"actual": 621.67,
		"predicted": 541.3753864131868
	},
	{
		"created_time":"2015-01-05T12:30",
		"actual": 673.02,
		"predicted": 548.2778818833758
	},
	{
		"created_time":"2015-01-06T12:30",
		"actual": 550.32,
		"predicted": 555.1803773535503
	},
	{
		"created_time":"2015-01-07T12:30",
		"actual": 516.51,
		"predicted": 562.0828728237248
	},
	{
		"created_time":"2015-01-08T12:30",
		"actual": 481.43,
		"predicted": 582.7903592342773
	},
	{
		"created_time":"2015-01-09T12:30",
		"actual": 440.08,
		"predicted": 589.6928547044517
	},
	{
		"created_time":"2015-01-10T12:30",
		"actual": 601.67,
		"predicted": 596.5953501746408
	},
	{
		"created_time":"2015-01-12T12:30",
		"actual": 561.59,
		"predicted": 603.4978456448152
	},{
		"created_time":"2015-01-16T12:30",
		"actual": 602.94,
		"predicted": 610.4003411149897
	},
	{
		"created_time": "2015-01-19T12:30",
		"actual": 695.56,
		"predicted": 631.1078275255422
	},
	{
		"created_time":"2015-01-20T12:30",
		"actual": 721.83,
		"predicted": 638.0103229957167
	},
	 {
	 	"created_time" : "2015-01-21T12:30",
		"actual": 783.18,
		"predicted": 644.9128184659057
	},
	{
		"created_time":"2015-01-22T12:30",
		"actual": 716.83,
		"predicted": 651.8153139360802
	},
	{
		"created_time":"2015-01-23T12:30",
		"actual": 734.37,
		"predicted": 658.7178094062692
	},
	{
		"created_time":"2015-01-26T12:30",
		"actual": 650.48,
		"predicted": 679.4252958168072
	},
	{
		"created_time":"2015-01-27T12:30",
		"actual": 584.13,
		"predicted": 686.3277912869817
	},
	{
		"created_time":"2015-01-28T12:30",
		"actual": 679.29,
		"predicted": 693.2302867571707
	},
	{
		"created_time":"2015-01-29T12:30",
		"actual": 690.56,
		"predicted": 700.1327822273452
	},{
		"created_time":"2015-01-30T12:30",
		"actual": 635.48,
		"predicted": 707.0352776975342
	},
	{
		"created_time": "2015-02-01T12:30",
		"actual": 695.56,
		"predicted": 631.1078275255422
	},
	{
		"created_time":"2015-02-02T12:30",
		"actual": 721.83,
		"predicted": 638.0103229957167
	},
	 {
	 	"created_time" : "2015-02-03T12:30",
		"actual": 783.18,
		"predicted": 644.9128184659057
	},
	{
		"created_time":"2015-02-04T12:30",
		"actual": 716.83,
		"predicted": 651.8153139360802
	},
	{
		"created_time":"2015-02-05T12:30",
		"actual": 734.37,
		"predicted": 658.7178094062692
	},
	{
		"created_time":"2015-02-06T12:30",
		"actual": 650.48,
		"predicted": 679.4252958168072
	},
	{
		"created_time":"2015-02-07T12:30",
		"actual": 584.13,
		"predicted": 686.3277912869817
	},
	{
		"created_time":"2015-02-08T12:30",
		"actual": 679.29,
		"predicted": 693.2302867571707
	},
	{
		"created_time":"2015-02-09T12:30",
		"actual": 690.56,
		"predicted": 700.1327822273452
	},{
		"created_time":"2015-02-10T12:30",
		"actual": 635.48,
		"predicted": 707.0352776975342
	},
	{
		"created_time":"2015-02-11T12:30",
		"actual": 601.67,
		"predicted": 596.5953501746408
	},
	{
		"created_time":"2015-02-12T12:30",
		"actual": 561.59,
		"predicted": 603.4978456448152
	},{
		"created_time":"2015-02-16T12:30",
		"actual": 602.94,
		"predicted": 610.4003411149897
	},
	{
		"created_time": "2015-02-19T12:30",
		"actual": 695.56,
		"predicted": 631.1078275255422
	},
	{
		"created_time":"2015-02-20T12:30",
		"actual": 721.83,
		"predicted": 638.0103229957167
	},
	 {
	 	"created_time" : "2015-02-21T12:30",
		"actual": 783.18,
		"predicted": 644.9128184659057
	},
	{
		"created_time":"2015-02-22T12:30",
		"actual": 716.83,
		"predicted": 651.8153139360802
	},
	{
		"created_time":"2015-02-23T12:30",
		"actual": 734.37,
		"predicted": 658.7178094062692
	},
	{
		"created_time":"2015-02-26T12:30",
		"actual": 650.48,
		"predicted": 679.4252958168072
	},
	{
		"created_time":"2015-02-27T12:30",
		"actual": 584.13,
		"predicted": 686.3277912869817
	},
	{
		"created_time":"2015-02-28T12:30",
		"actual": 679.29,
		"predicted": 693.2302867571707
	},
	{
		"created_time":"2015-02-29T12:30",
		"actual": 690.56,
		"predicted": 700.1327822273452
	},{
		"created_time":"2015-02-30T12:30",
		"actual": 635.48,
		"predicted": 707.0352776975342
	}
];

//set time frame to request data from the backend 
window.datenow = function() {
	//include a GET AJAX HERE to the end point
            $.ajax({
                url: "/predict",
                    //URL for the request
                type: "GET",
                    // this is a GET request
                dataType: "json",
                    // data we expect back
                data : {'start_time' : document.getElementById('start_time').value, 'end_time' : document.getElementById('end_time').value},
                success: function (response) {
                    // print out the data we get back
                    console.log(response);
                    var obj = jQuery.parseJSON(response);

                    //get the key for each response
                    for(key in Object.keys(obj)) {
                    	var val = Object.keys(obj)[key];
                    	console.log(val);
					};

					//get the value for each response
                    for(key in obj) {
					    if(obj.hasOwnProperty(key)) {
					        var value = obj[key];
					        console.log(value);
					    }
					};
                },
                error: function (xhr, status) {
                    // if request fails print out this
                    console.log("Sorry, there is a problem!");
                },
                complete: function (xhr, status) { // code to runs if yay or nay
                    console.log("The request is now complete!");
                }
            })
	  };

var ndx = crossfilter(dataset);

var actual2 = ndx.dimension(function(d){return d.actual; });

var parseDate2 = d3.time.format("%Y-%m-%dT%H:%M").parse;

dataset.forEach(function(d){
	d.date = parseDate2(d.created_time);
	d.actual2 = d.actual;
	d.total = Math.abs(d.actual - d.predicted);
	d.month = d3.time.month(d.date);
});

var dateDimen = ndx.dimension(function(d) {return d.date;});
var actualHits = dateDimen.group().reduceSum(function(d) {return d.actual2; });
var predictedHits = dateDimen.group().reduceSum(function(d) {return d.predicted; });
var total2 = dateDimen.group().reduceSum(function(d){return d.total; });

var minDate = dateDimen.bottom(1)[0].date;
var maxDate = dateDimen.top(1)[0].date;

// start of dc.js js sccript for predicting energy

var productslineChart = dc.lineChart("#chart-product-hitsperday");
productslineChart.width(700).height(350)
			.dimension(dateDimen)
			.group(actualHits, 'actual')
			.stack(predictedHits, 'predicted')
			.stack(total2, 'Abs. Diff.')
			.renderArea(true)
			.x(d3.time.scale().domain([minDate,maxDate]))
			.renderHorizontalGridLines(true)
			.renderVerticalGridLines(true)
			.legend(dc.legend().x(55).y(12).itemHeight(13).gap(5))
			.brushOn(false)
			.elasticX(true)
			.yAxisLabel("Actual Energy")
			.margins({top:11, left:51, right:11, bottom:51})
			.on("renderlet", function (chart) {chart.selectAll("g.x text").attr('dx', '-35').attr('dy', '-9').attr('transform', "rotate(-90)");});

//computattion of pie chart for months
var prod_monthRingChart = dc.pieChart("#chart-product-month");
var monthDim = ndx.dimension(function(d){return d.month; });
var month_total = monthDim.group().reduceSum(function(d){return d.actual2; });

prod_monthRingChart.width(150).height(150)
				.dimension(monthDim)
				.group(month_total)
				.innerRadius(30);

//end of dc.js js sccript for predicting energy
dc.renderAll();


